
@{
    ViewBag.Title = "Invoice";
    Layout = "~/Views/Shared/_LayoutDashboardAdmin.cshtml";
    string message = @ViewBag.Message;
}
@if (message == "InvoiceSuccess")
{
<script src="~/js/jquery-3.3.1.min.js"></script>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <script type="text/javascript">
                            swal({
                                    title: "Invoice Saved",
                                    icon: "success",
                            });
        
        window.location.href = "/AdminDashboard/GeneratePDF?invId=" + @Html.Raw(Json.Encode(ViewBag.InvoiceID));

    </script>
}
else if (message == "Invoiced")
{
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <script type="text/javascript">
        swal({
            title: "Sorry!",
        text: "This order is already invoiced",
        icon: "error",
    });
    </script>
}
else if (message == "InvoiceError")
{
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <script type="text/javascript">
                swal({
                    title: "OOPS! Invoice not save",
                    text: "You have not selected any Services or Items.",
                    icon: "error",
                });
    </script>
}
else if (message == "InvoiceErr")
{
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <script type="text/javascript">
                swal({
                    title: "Sorry",
                    text: "Invoice not saved.Please Try Again!",
                    icon: "error",
                });
    </script>
}
else if (message == "ItemsError")
{
    <script type="text/javascript">
                swal({
                    title: "OOPS! Items not add",
                text: "Please Try again.",
                icon: "error",
            });
    </script>
}
else if (message == "ServiceError")
{
    <script type="text/javascript">
                swal({
                    title: "OOPS! Service not add",
                text: "Please Try again.",
                icon: "error",
            });
    </script>
}
else if (message == "ServiceSuccess")
{
    <script type="text/javascript">
                swal({
                    title: "Service added",
                icon: "success",
            });
    </script>
}
else if (message == "ItemSuccess")
{
    <script type="text/javascript">
                swal({
                    title: "Item added",
                icon: "success",
            });
    </script>
}




<div class="page-inner">
    <div class="page-title">
        <h3 class="breadcrumb-header d-inline">Invoice</h3>
        <a href="~/ReportInvoice.aspx" class="btn btn-outline-dark float-right"><i class="fa fa-print"> Print </i> </a>

    </div>
    <!-- start page main wrapper -->
    <div id="main-wrapper">
        <div class="card card-white">
            <p class="text-right">Order#: <span class="text-black-50"> @Model.OrderId </span></p>
            <!--Client_info start-->
            <div class="row">
                <div class="col-md-12">
                    <div class="card card-white">
                        <div class="card-body">
                            <div class="row">

                                <div class="col-md-12" id="Client_info">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <p>Client Name: <span class="float-right text-black-50">@Model.CustomerName </span></p>
                                            <p>Address: <span class="float-right text-black-50">@Model.Address</span></p>
                                            <p>Contact: <span class="float-right text-black-50">@Model.Contact</span></p>
                                        </div>
                                        <div class="col-md-6">
                                            <p>Service Category/Type: <span class="float-right text-black-50">@Model.STPServiceType.ServiceTypeName</span></p>
                                            <p>AC Type: <span class="float-right text-black-50">@Model.STPServicesFuelType.Options</span></p>
                                            <p>Unit: <span class="float-right text-black-50">@Model.STPServicesUnitType.Options</span></p>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--Client_info end-->
            <!--Add service and item start-->
            <!-- Row -->
            <div class="row">
                <div class="col-md-12" id="Add">
                    <div class="row">
                        @{Html.RenderAction("InvService", "AdminDashboard", new { fuelTypeID = @Model.FuelTypeId, UnitTypeID = @Model.UnitTypeId });}
                        @{Html.RenderAction("InvItems", "AdminDashboard", new { fuelTypeID = @Model.FuelTypeId, UnitTypeID = @Model.UnitTypeId });}

                    </div>
                </div>
            </div>
            <!--Add service and item end-->
            <!-- Row -->
            <div class="row">
                <div class="col-md-12" id="List">
                    <div class="row">

                        <div class="col-md-6">
                            <div class="card card-white">
                                <div class="card-heading clearfix">
                                    <h4 class="card-title">Services Added</h4>
                                </div>
                                <div class="card-body">

                                    <div class="table-responsive">
                                        <table class="table table-bordered" id="SerTable">
                                            <thead>
                                                <tr>
                                                    <th>#</th>
                                                    <th>Service Name</th>
                                                    <th>Service Charges</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                            </tbody>
                                        </table>
                                    </div>

                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card card-white">
                                <div class="card-heading clearfix">
                                    <h4 class="card-title">Items Added</h4>
                                </div>
                                <div class="card-body">

                                    <div class="table-responsive">
                                        <table class="table table-bordered" id="ItemTable">
                                            <thead>
                                                <tr>
                                                    <th>#</th>
                                                    <th>Item Name</th>
                                                    <th>Model No</th>
                                                    <th>Item Charges</th>
                                                    <th>Qty</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                            </tbody>
                                        </table>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Row -->

            </div>
            <!-- Row -->
            <div class="row">
                <div class="col-md-12" id="Bill">
                    <div class="row">
                        <div class="col-md-9">
                            <div class="card card-white">
                                <div class="card-heading clearfix">
                                    <h4 class="card-title">Total Charges</h4>
                                </div>
                                <div class="card-body">

                                    <div class="table-responsive">
                                        <table class="table">
                                            <thead>
                                                <tr>
                                                    <th>#</th>
                                                    <th>Description</th>
                                                    <th>Charges</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <th scope="row">1</th>
                                                    <td>Service Charges</td>
                                                    <td id="SerCharges">00</td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">2</th>
                                                    <td>Item Charges</td>
                                                    <td id="ItemCharges">00</td>
                                                </tr>
                                                <tr class="border-bottom border-double border-color-dark-gray">
                                                    <th scope="row"></th>
                                                    <td>Total</td>
                                                    <td id="Total">00</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>

                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 text-right">
                            <h4 class="m-t-lg">Thank you!</h4>
                            <p>
                                Voluptas sit aspernatur aut odit aut fugit consequur.
                                <br>Sed ut perspiciatis unde omnis iste natus
                                <br>Minim veniam, quis nostrud exercitation ullamco laboris.
                            </p>
                            <img src="~/img/Dashboard/signature-black.png" class="m-t-lg" alt="">
                        </div>

                    </div>
                    <div class="row">
                        <button class="btn btn-primary" onclick="postInvoice()"> Save Invoice</button>
                    </div>
                </div>
                <!-- Row -->
            </div>
            <!-- end page main wrapper -->
        </div>

        <div class="page-footer">
            <p>
                Copyright &copy;
                <script>document.write(new Date().getFullYear())</script>
 Kaam Waley All rights reserved.
            </ p >
        </ div >
    </ div >
    < !--end page inner -->
    < !--start page inner -->
@*<div class="page-inner">
        <div class="page-title">
            <h3 class="breadcrumb-header">Invoice</h3>
        </div>
        <!-- start page main wrapper -->
        <div id="main-wrapper">
            <div class="row">
                <div class="col-md-12">
                    <div class="card card-white">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-4">
                                    <h3 class="m-b-md m-t-xxs"><b>Company</b></h3>
                                    <address>
                                        London<br>
                                        P: (+44) 123 456 789
                                    </address>
                                </div>
                                <div class="col-md-8 text-right">
                                    <h3 class="m-t-xs">Invoice</h3>
                                    <button type="button" class="btn btn-outline-primary"><i class="fa fa-print"></i> Print</button>
                                </div>
                                <div class="col-md-12">
                                    <hr>
                                    <p>
                                        <strong>Invoice to</strong>
                                        <br> Keir Prestonly
                                        <br> Regina ST,
                                        <br> London, SK 8GH.
                                    </p>
                                </div>
                                <div class="col-md-12">
                                    <div class="table-responsive">
                                        <table class="table">
                                            <thead>
                                                <tr>
                                                    <th>Item</th>
                                                    <th>Description</th>
                                                    <th>Quantity</th>
                                                    <th>Price</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>1</td>
                                                    <td>Brochure Design</td>
                                                    <td>13</td>
                                                    <td>$1157</td>
                                                </tr>
                                                <tr>
                                                    <td>2</td>
                                                    <td>Basic Template</td>
                                                    <td>02</td>
                                                    <td>$2394</td>
                                                </tr>
                                                <tr>
                                                    <td>3</td>
                                                    <td>Wordpress Theme</td>
                                                    <td>04</td>
                                                    <td>$9080</td>
                                                </tr>
                                                <tr>
                                                    <td>4</td>
                                                    <td>HTML Template</td>
                                                    <td>02</td>
                                                    <td>$8105</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <div class="col-md-8">
                                    <h4 class="m-t-lg">Thank you!</h4>
                                    <p>
                                        Voluptas sit aspernatur aut odit aut fugit consequur.
                                        <br>Sed ut perspiciatis unde omnis iste natus
                                        <br>Minim veniam, quis nostrud exercitation ullamco laboris.
                                    </p>
                                    <img src="~/img/Dashboard/signature-black.png" class="m-t-lg" alt="">
                                </div>
                                <div class="col-md-4">
                                    <div class="text-right m-t-lg">
                                        <h4 class="no-m m-t-sm">Subtotal</h4>
                                        <h2 class="no-m">$20736</h2>
                                        <hr>
                                        <h4 class="no-m m-t-sm">Shipping</h4>
                                        <h2 class="no-m">$400</h2>
                                        <hr>
                                        <h4 class="no-m m-t-md text-success">Total</h4>
                                        <h1 class="no-m text-success">$21136</h1>
                                        <hr>
                                        <button class="btn btn-info">Submit your invoice</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Row -->
        </div>
        <!-- end page main wrapper -->
        <div class="page-footer">
            <p>Copyright &copy;
            <script>document.write(new Date().getFullYear())</script> Kaam Waley All rights reserved.</p>
        </div>
    </div>*@
<!-- end page inner -->
</div>


@section scripts{

    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <script>
        //data bind with dropdown change start----------------
                $("#ItemName").change(function () {
                    var ID = this.value;
                    //console.log("reach");
                    $.ajax({
                            url: "/AdminDashboard/getItemNo",
                            data: { "ID": ID ,"fuelTypeId": @Model.FuelTypeId,"unitTypeId":@Model.UnitTypeId},
                            type: "Post",
                            dataType: "json",
                            success: function (response) {
                                $.each(response, function (index, value) {

                                    $("#ModelNo").append(
                                    $('<option></option>').val(value.ID).html(value.ServiceModelNo));
                                });

                            },
                        error: function (data) {
                            console.log(data);
                            }
                        });

                });

                $("#ModelNo").change(function () {
                    var ID = this.value;

                    $.ajax({
                            url: "/AdminDashboard/getPrice",
                            data: { "ID": ID},
                            type: "Post",
                            dataType: "json",
                            success: function (data) {

                                $("#SellingPrice").val(data);
                            },
                        error: function (data) {
                            console.log(data);
                            }
                        });

                });
        //data bind with dropdown change end----------------



        var total = 0;


        //Item Add start-------------
        var ItemsRatetotal =0;
        var ItemCount = 0;
        function btnItemPost() {
            var ItemName = $("#ItemName option:selected").text();
            var ModelNoId = $("#ModelNo").val();
            var ModelNo = $("#ModelNo option:selected").text();
            var OrderId = @Model.OrderId;
            var SellingPrice = $("#SellingPrice").val();


            var QTY = $("#QTY").val();
            //console.log(QTY);


             var data = JSON.stringify({
                 'ModelNoId': ModelNoId,
                 'OrderId': OrderId,
                 'QTY':QTY
             });

            //console.log(data);
            $.ajax({
                            url: "/AdminDashboard/PostItem",
                            data: data,
                            type: "Post",
                            contentType: 'application/json',
                            success: function (data) {
                                //console.log("data Add");
                                ItemCount++;
                                $("#ItemsCount span").html(ItemCount);
                                ItemsRatetotal += parseInt(SellingPrice) * QTY;
                                //console.log(ItemsRatetotal);

                                //show data on table
                                $('#ItemTable tbody').append('<tr><td>' + ItemCount + '</td><td>' + ItemName + '</td><td>' + ModelNo + '</td><td>' + SellingPrice + '</td><td>' + QTY + '</td></tr>');

                                $("#ItemCharges").html(ItemsRatetotal);


                                total += parseInt(SellingPrice) * QTY;
                                $('#Total').html(total);
                            },
                            error: function (data) {
                                console.log(data);
                            }
                        });
        }

        //Item Add end-------------

        //Services Add start-------------
        var ServiceRatetotal=0 ;
            var ServiceCount = 0;
            function btnServicePost() {
                var ServiceID = $("#ServiceName").val();
                var ServiceName = $("#ServiceName option:selected").text();
                var ServiceRate = $("#ServiceRate").val();

            var OrderId = @Model.OrderId;

             var data = JSON.stringify({
                 'ServiceID': ServiceID,
                 'OrderID': OrderId
             });

            //console.log(data);
            $.ajax({
                            url: "/AdminDashboard/PostServices",
                            data: data,
                            type: "Post",
                            contentType: 'application/json',
                            success: function (data) {
                                //console.log("Service Add");
                                
                                ServiceRatetotal += parseInt(ServiceRate);

                                //counter start
                                ServiceCount++;
                                $("#ServiceCount span").html(ServiceCount);
                                //counter start
                                
                                //data edit in total charges div start
                                var PlatformCharges = ServiceRatetotal * 2 / 100;
                                var ServicePlatform = ServiceRatetotal + PlatformCharges;
                                //console.log(ServicePlatform);

                                //show data on table start
                                $('#SerTable tbody').append('<tr><td>' + ServiceCount + '</td><td>' + ServiceName + '</td><td>' + ServicePlatform + '</td></tr>');
                                //show data on table end


                                $("#SerCharges").html(ServicePlatform);

                                total += parseInt(ServicePlatform);
                                $('#Total').html(total);
                            },
                            error: function (data) {
                                console.log(data);
                            }
                        });
                }

        //Services Add end---------------

        function postInvoice() {

            var PlatformCharges = ServiceRatetotal * 2 / 100;
            var ServiceTotal = ServiceRatetotal + PlatformCharges;
            var Total = ServiceTotal + ItemsRatetotal;
            var data = JSON.stringify({
                'OrderID':@Model.OrderId,
                'PlatformCharges':PlatformCharges,
                 'ServiceRatetotal':ServiceRatetotal,
                 'ItemsRatetotal':ItemsRatetotal,
                 'Total':Total
             });

            //console.log(data);
            $.ajax({
               url: "/AdminDashboard/PostInvoice",
               data: data,
               type: "Post",
               contentType: 'application/json',
               success: function (data) 
               {
               },
               error: function () {
               location.reload(); // then reload the page.(3)
               },
                complete: function (p) {
                    location.reload(); // then reload the page.(3)
                }
                                });

        }

    </script>

}
